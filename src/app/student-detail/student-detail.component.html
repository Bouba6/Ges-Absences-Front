<!-- Template principal -->
<div class="wrapper">
  <!-- Header avec info √©tudiant et bouton d√©connexion -->
  <header class="header">
    <div class="student-info">
      <ng-container *ngIf="student$ | async as stu; else loadingStudent">
        <div class="avatar">
          <span class="avatar-icon">üë§</span>
        </div>
        <div class="student-text">
          <h2>{{ stu.name }}</h2>
          <p>{{ stu.role }}, {{ stu.promotion }}</p>
        </div>
      </ng-container>
      <ng-template #loadingStudent>
        <h2>Chargement‚Ä¶</h2>
      </ng-template>
    </div>
    <button class="btn-logout">D√©connexion</button>
  </header>

  <!-- Section principale : absences/retards -->
  <section class="content student-detail">
    <div class="absences-container">
      <!-- Titre et filtres -->
      <p class="section-title">Absences / Retards</p>
      <div class="filters">
        <select>
          <option value="">Date</option>
        </select>
        <select>
          <option value="">Mati√®re</option>
        </select>
        <select>
          <option value="">Type</option>
          <option value="Absence">Absence</option>
          <option value="Retard">Retard</option>
        </select>
        <select>
          <option value="">Justification</option>
          <option value="Maladie">Maladie</option>
          <option value="D√©c√®s">D√©c√®s</option>
          <option value="Embouteillage">Embouteillage</option>
        </select>
      </div>

      <!-- Tableau des absences -->
      <table class="absences-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Mati√®re</th>
            <th>Type</th>
            <th>Justification</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let abs of absencesForDisplay; let i = index"
            [ngClass]="{ 'justified': abs.isJustified }"
          >
            <td>{{ abs.date }}</td>
            <td>{{ abs.subject }}</td>
            <td>{{ abs.type }}</td>
            <td>
              <span *ngIf="abs.justification">{{ abs.justification }}</span>
              <span *ngIf="!abs.justification">-</span>
            </td>
            <td>
              <div class="action-buttons">
                <button
                  class="btn-view"
                  *ngIf="abs.justification"
                  (click)="viewJustification(abs)"
                >
                  Voir
                </button>
                <button
                  class="btn-justify"
                  [disabled]="abs.isJustified"
                  (click)="openJustificationPopup(abs)"
                >
                  {{ abs.isJustified ? 'Justifi√©' : 'Justifier' }}
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>

<!-- Overlays -->
<!-- Modal de visualisation de justification -->
<div class="overlay" *ngIf="showViewJustif">
  <div class="view-justif-modal">
    <h3>Justification de l'absence</h3>
    <p><strong>Date :</strong> {{ selectedAbsence?.date }}</p>
    <p><strong>Mati√®re :</strong> {{ selectedAbsence?.subject }}</p>
    <p><strong>Type :</strong> {{ selectedAbsence?.type }}</p>
    <p><strong>Statut :</strong> {{ selectedAbsence?.justification }}</p>
    <p *ngIf="selectedAbsence?.justificationComment"><strong>Commentaire :</strong> {{ selectedAbsence?.justificationComment }}</p>
    <div class="modal-buttons">
      <button class="btn-close" (click)="closeViewJustif()">Fermer</button>
    </div>
  </div>
</div>

<!-- Popup de justification -->
<div class="overlay" *ngIf="showJustifPopup">
  <div class="popup justify-popup">
    <div class="popup-header">
      <h3>Justification de l'absence</h3>
      <button class="btn-close" (click)="closeJustificationPopup()">√ó</button>
    </div>
    <div class="popup-content">
      <div class="justification-details">
        <div class="form-group">
          <label>Statut de l'absence</label>
          <div class="status-value">
            {{ selectedAbsence?.justification || 'Non justifi√©e' }}
          </div>
        </div>

        <div class="form-group" *ngIf="selectedAbsence?.justificationComment">
          <label>Commentaire</label>
          <div class="comment-value">
            {{ selectedAbsence?.justificationComment }}
          </div>
        </div>

        <div class="form-group">
          <label>Date</label>
          <div class="date-value">
            {{ selectedAbsence?.date }}
          </div>
        </div>

        <div class="form-group">
          <label>Mati√®re</label>
          <div class="subject-value">
            {{ selectedAbsence?.subject }}
          </div>
        </div>

        <div class="form-group">
          <label>Type</label>
          <div class="type-value">
            {{ selectedAbsence?.type }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
